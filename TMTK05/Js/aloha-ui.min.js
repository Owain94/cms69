(function(n){"use strict";function w(t,i){var r=t.shift();return n.editor.ui.actions[r]?n.editor.ui.actions[r].apply(window,i.concat(t)):i}function b(n){var i,r=[];return t.childAndParentsUntil(n,function(n){return(n.className&&(i=n.className.match(/aloha-action-(\S+)/)),i||t.hasClass(n,"aloha-ui"))?!0:!1}),i&&(r=i[1].split("-"),r.unshift(i[0])),r}function l(){u(".aloha-ui .active, .aloha-ui.active").removeClass("active")}function k(n){var t=n.reduce(function(n,t){return n.concat(".aloha-ui ."+c+t)},[]);u(t.join(",")).addClass("active")}function d(n){var e=n.reduce(function(n,t){return n.concat(".aloha-ui .dropdown-menu ."+c+t)},[]),i=u(e.join(",")).elements[0],f,r;i&&(f=t.upWhile(i,function(n){return!t.hasClass(n,"btn-group")}),r=f.querySelector(".dropdown-toggle"),t.addClass(r,"active"),r.firstChild.data=i.textContent+" ")}function g(n){var u=t.childAndParentsUntilIncl(e.container(n.boundaries[0]),function(n){return t.isEditingHost(n)}),s=f.joinToSet(n.formatting,n.overrides),i=u.map(function(n){return n.nodeName}),r=[];return s.forEach(function(n){var t=f.stateToNode[n[0]];t&&(n[1]?i.push(t):r.push(t))}),o.difference(o.unique(i),r)}function nt(n,t){k(t);d(t)}function s(t){l();var i=g(t);n.editor.ui.updateHandlers.forEach(function(n){n(t,i)})}function tt(t){var i=t.type,r;return"keydown"===i&&(r=v.shortcutHandler(t.meta,t.keycode,n.editor.ui.shortcuts),r)?(t.selection.boundaries=r(t.selection.boundaries[0],t.selection.boundaries[1]),r.name==="insertLink"&&(t.preventSelection=!0),t):(("mouseup"===i||"aloha.mouseup"===i)&&(h.inEditable=!0),("keydown"===i||"keyup"===i||"mouseup"===i||"click"===i)&&s(t.selection),t)}function a(n,t,u){var o,s,h;return e.equals(n,t)?(o=i.selection,s=f.nodeToState[u],!s||!o)?[n,t]:(h=f.joinToSet(o.formatting,f.harvest(e.container(n)),o.overrides),o.overrides=f.toggle(h,s,!0),[n,t]):r.format(n,t,u)}var t=n.dom,v=n.keys,i=n.editor,y=n.events,r=n.editing,f=n.overrides,p=n.selections,e=n.boundaries,o=n.arrays,c="aloha-action-",u=function(){function n(n){this.elements=typeof n=="string"?o.coerce(document.querySelectorAll(n)):[n]}return n.prototype={elements:[],on:function(n,t){return this.elements.forEach(function(i){y.add(i,n,t)}),this},addClass:function(n){return this.elements.forEach(function(i){t.addClass(i,n)}),this},removeClass:function(n){return this.elements.forEach(function(i){t.removeClass(i,n)}),this},setAttr:function(n,i){return this.elements.forEach(function(r){t.setAttr(r,n,i)}),this}},function(t){return new n(t)}}(),h={inEditable:!1};u(document).on("mousedown",function(){h.inEditable=!1});u(document).on("mouseup",function(n){if(!h.inEditable){var r=t.upWhile(n.target,function(n){return!t.hasClass(n,"aloha-ui")});r||(i.selection&&t.setStyle(i.selection.caret,"display","none"),i.selection=null,l())}});u(".aloha-ui").on("mousedown",function(n){var t,r;n.target.nodeName!=="INPUT"&&(t=b(n.target),t&&i.selection&&(r=w(t,i.selection.boundaries),i.selection=p.select(i.selection,r[0],r[1]),s(i.selection)))});n.editor.stack.unshift(tt);n.editor.ui={$$:u,shortcuts:{},actions:{"aloha-action-B":a,"aloha-action-I":a,"aloha-action-H2":r.format,"aloha-action-H3":r.format,"aloha-action-H4":r.format,"aloha-action-P":r.format,"aloha-action-PRE":r.format,"aloha-action-OL":r.format,"aloha-action-UL":r.format,"aloha-action-unformat":function(n,t){var i=[n,t];return["B","I","U"].forEach(function(n){i=r.unformat(i[0],i[1],n)}),i}},update:s,updateHandlers:[nt]}})(window.aloha);
/*
//# sourceMappingURL=aloha-ui.min.js.map
*/