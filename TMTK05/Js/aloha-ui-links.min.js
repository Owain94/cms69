(function(n){"use strict";function b(r,u){var f=n.carets.box(i.range(i.create(u,0),i.create(u,1))),s=Math.round(f.left+f.width/2),h=t.documentWindow(u.ownerDocument),c=h.innerWidth,o=parseInt(t.getComputedStyle(r,"width"),10),e=10,l=e,a=c-o-e,v=Math.min(a,Math.max(l,s-o/2)),y=f.top+f.height+e;t.setStyle(r,"left",v+"px");t.setStyle(r,"top",y+"px")}function e(n){return"A"!==n.nodeName}function a(n,i){var u=t.getAttr(i,"href"),f=t.getAttr(i,"target");r(".aloha-active").removeClass("aloha-active");t.addClass(i,"aloha-active");t.addClass(n,"active");b(n,i);n.querySelector("input").value=u;r("a.aloha-link-follow").setAttr("href",u);"_blank"===f?r(".aloha-action-target").addClass("active"):r(".aloha-action-target").removeClass("active")}function o(){return t.upWhile(r(".aloha-link-toolbar").elements[0],function(n){return!t.hasClass(n,"aloha-ui")})}function s(n){return t.upWhile(i.container(n[0]),e)||t.upWhile(i.container(n[1]),e)}function k(n){r("a.aloha-active, a.aloha-link-follow").setAttr("href",n.querySelector("input").value)}function d(n,r){for(var u,f=[n,r],o=0;o<f.length;o++)if(u=t.upWhile(i.container(f[o]),e),u)return[i.fromStartOfNode(u),i.fromEndOfNode(u)];return i.equals(n,r)?w.expand(n,r,"word"):f}function h(n,t){var u=d(n,t);return i.container(u[0]).nodeName!=="A"&&(u=y.wrap("A",u[0],u[1]),u[0]=i.next(u[0]),u[1]=i.fromEndOfNode(u[0])[0]),a(o(),i.container(u[0])),r(".aloha-link-toolbar input[name=href]").elements[0].focus(),u}function g(n,i){var u=[n,i],r=s(u);return r?("_blank"===t.getAttr(r,"target")?t.removeAttr(r,"target"):t.setAttr(r,"target","_blank"),u):u}function nt(n,t){v.contains(t,"A")?a(o(),s(n.boundaries)):r(".aloha-active").removeClass("aloha-active")}var f=n.editor.ui,r=f.$$,t=n.dom,c=n.keys,l=n.maps,u=n.editor,v=n.arrays,y=n.editing,p=n.selections,i=n.boundaries,w=n.traversing,tt={enter:function(n,e){var o=r("a.aloha-active").elements[0],h,s;return o?(h=r(".aloha-link-toolbar input[name=href]").elements[0],s=i.next(i.fromEndOfNode(o)),u.selection=p.select(u.selection,s,s),h.value||t.removeShallow(o),f.update(u.selection),u.selection.boundaries):[n,e]}};r(".aloha-link-toolbar input[name=href]").on("keyup",function(n){u.selection&&k(o(),s(u.selection.boundaries));var t=c.parseKeys(n),i=c.shortcutHandler(t.meta,t.keycode,tt);i&&(u.selection.boundaries=i(u.selection.boundaries[0],u.selection.boundaries[1]))});f.actions=l.merge(f.actions,{"aloha-action-A":h,"aloha-action-target":g});f.shortcuts=l.merge(f.shortcuts,{"meta+k":h,"ctrl+k":h});f.updateHandlers.push(nt)})(window.aloha);
/*
//# sourceMappingURL=aloha-ui-links.min.js.map
*/